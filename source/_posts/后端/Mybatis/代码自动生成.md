---
title: 代码自动生成
date: 2021-01-03 16:25:32
tags: Maybatis
categories: Maybatis
---

## 代码配置类

```java
package com.mega.werewolfmonitor.core.util;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.core.toolkit.StringPool;
import com.baomidou.mybatisplus.generator.AutoGenerator;
import com.baomidou.mybatisplus.generator.InjectionConfig;
import com.baomidou.mybatisplus.generator.config.*;
import com.baomidou.mybatisplus.generator.config.po.TableInfo;
import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;
import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;

import java.util.ArrayList;
import java.util.List;

public class CodeGenerator {

    //数据源配置(测试环境)
   private static final String JDBC_URL = "jdbc:mysql://localhost:3306/werewolf?useUnicode=true&useSSL=true&characterEncoding=utf8";
   private static final String JDBC_USERNAME = "root";
   private static final String JDBC_PASSWORD = "root";
   private static final String JDBC_DRIVER = "com.mysql.jdbc.Driver";

    //作者
    private static final String AUTHOR = "mybatisplus";

    //需要生成表的表名
    private static final String[] TABLE_STRS = new String[]{"item_produce_gift_bag_mining_user_record_history","item_produce_gift_bag_mining_user_receive_history"};

    //是否生成service代码。有时候service代码不必要
    private static final Boolean SERVICE_FLAG = false;
    private static final String SERVICE_NAME = "monitor";

    private static final String USER_DIR = System.getProperty("user.dir");
    private static final String PROJECT_PATH_JAVAFILE = "/src/main/java";
    private static final String PROJECT_PATH_RESOURCES = "/src/main/resources";
    //模块名配置
    private static final String MODULE_PARENT = "/com/mega/werewolfmonitor";
    private static final String PACKAGE_PARENT = "com.mega.werewolfmonitor";

    public static void main(String[] args) {

        //1、全局配置
        GlobalConfig config = new GlobalConfig();
        config.setActiveRecord(true)//开启AR模式
                .setAuthor(AUTHOR)//设置作者
                .setOutputDir(USER_DIR)
                .setFileOverride(true)//第二次生成会把第一次生成的覆盖掉
                .setIdType(IdType.AUTO)//主键策略
                .setServiceName("%sService")//生成的service接口名字首字母是否为I，这样设置就没有I
                .setBaseResultMap(true)//生成resultMap
                .setOpen(false)//不打开文件夹
                .setBaseColumnList(true);//在xml中生成基础列
        //2、数据源配置
        DataSourceConfig dataSourceConfig = new DataSourceConfig();
        dataSourceConfig.setDbType(DbType.MYSQL)//数据库类型
                .setDriverName(JDBC_DRIVER)
                .setUrl(JDBC_URL)
                .setUsername(JDBC_USERNAME)
                .setPassword(JDBC_PASSWORD);
        //3、策略配置
        StrategyConfig strategyConfig = new StrategyConfig();
        strategyConfig.setCapitalMode(true)//开启全局大写命名
                .setColumnNaming(NamingStrategy.underline_to_camel)//表名字段名使用下划线
                .setNaming(NamingStrategy.underline_to_camel)//下划线到驼峰的命名方式
                .setEntityLombokModel(true)//使用lombok
                .setRestControllerStyle(true)//restful controller
                .setInclude(TABLE_STRS);//逆向工程使用的表
        //4、包名策略配置
        //自定义配置mapper文件路径至resources下
        InjectionConfig injectionConfig = new InjectionConfig() {
            @Override
            public void initMap() {
                // to do nothing
            }
        };
        // 如果模板引擎是 freemarker
        String xmlTemplatePath = "/templates/mapper.xml.ftl";
        String mapperTemplatePath = "/templates/mapper.java.ftl";
        String entityTemplatePath = "/templates/entity.java.ftl";
        String serviceTemplatePath = "/templates/service.java.ftl";
        String serviceImplTemplatePath = "/templates/serviceImpl.java.ftl";
        String apiTemplatePath = "/templates/controller.java.ftl";
        // 自定义输出配置
        List<FileOutConfig> focList = new ArrayList<FileOutConfig>();
        // 自定义配置会被优先输出
        focList.add(new FileOutConfig(xmlTemplatePath) {
            @Override
            public String outputFile(TableInfo tableInfo) {
                return USER_DIR + "/werewolf-monitor-data" + PROJECT_PATH_RESOURCES + "/mapper/" + tableInfo.getEntityName() + "Mapper" + StringPool.DOT_XML;
            }
        });
        focList.add(new FileOutConfig(entityTemplatePath) {
            @Override
            public String outputFile(TableInfo tableInfo) {
                return USER_DIR + "/werewolf-monitor-data" + PROJECT_PATH_JAVAFILE + MODULE_PARENT + "/data/entity/" + tableInfo.getEntityName() + StringPool.DOT_JAVA;
            }
        });
        focList.add(new FileOutConfig(mapperTemplatePath) {
            @Override
            public String outputFile(TableInfo tableInfo) {
                return USER_DIR + "/werewolf-monitor-data" + PROJECT_PATH_JAVAFILE + MODULE_PARENT + "/data/mapper/" + tableInfo.getEntityName() + "Mapper" + StringPool.DOT_JAVA;
            }
        });
        if (SERVICE_FLAG) {
            focList.add(new FileOutConfig(serviceTemplatePath) {
                @Override
                public String outputFile(TableInfo tableInfo) {
                    return USER_DIR + "/werewolf-monitor-" + SERVICE_NAME + PROJECT_PATH_JAVAFILE + MODULE_PARENT + "/" + SERVICE_NAME + "/service/" + tableInfo.getEntityName() + "Service" + StringPool.DOT_JAVA;
                }
            });
            focList.add(new FileOutConfig(serviceImplTemplatePath) {
                @Override
                public String outputFile(TableInfo tableInfo) {
                    return USER_DIR + "/werewolf-monitor-" + SERVICE_NAME + PROJECT_PATH_JAVAFILE + MODULE_PARENT + "/" + SERVICE_NAME + "/service/impl/" + tableInfo.getEntityName() + "ServiceImpl" + StringPool.DOT_JAVA;
                }
            });
        }
//        focList.add(new FileOutConfig(apiTemplatePath) {
//            @Override
//            public String outputFile(TableInfo tableInfo) {
//                return USER_DIR + "/api" + PROJECT_PATH_JAVAFILE + MODULE_PARENT + "/api/controller/" + tableInfo.getEntityName()+ "Controller" + StringPool.DOT_JAVA;
//            }
//        });
        injectionConfig.setFileOutConfigList(focList);

        TemplateConfig templateConfig = new TemplateConfig();
        templateConfig.setXml(null);
        templateConfig.setController(null);
        templateConfig.setServiceImpl(null);
        templateConfig.setService(null);
        templateConfig.setEntity(null);
        templateConfig.setMapper(null);

        PackageConfig packageConfig = new PackageConfig();
        packageConfig.setParent(PACKAGE_PARENT)
                .setMapper("data.mapper")
                .setService(SERVICE_NAME + ".service")
                .setServiceImpl(SERVICE_NAME + ".service.impl")
//                .setController("api.controller")
                .setEntity("data.entity");
        //5、整合配置
        AutoGenerator autoGenerator = new AutoGenerator();
        autoGenerator.setGlobalConfig(config)
                .setDataSource(dataSourceConfig)
                .setStrategy(strategyConfig)
                .setPackageInfo(packageConfig)
                .setTemplate(templateConfig)
                .setCfg(injectionConfig)
                .setTemplateEngine(new FreemarkerTemplateEngine());
        //6、执行
        autoGenerator.execute();
    }

}

```

## 依赖

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.3.2</version>
</dependency>
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-generator</artifactId>
    <version>3.3.2</version>
</dependency>
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>dynamic-datasource-spring-boot-starter</artifactId>
    <version>3.0.0</version>
</dependency>
<dependency>
    <groupId>org.freemarker</groupId>
    <artifactId>freemarker</artifactId>
    <version>2.3.30</version>
</dependency>
```